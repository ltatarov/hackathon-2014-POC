
AURORA.audienceScienceManager=(function(jQuery,window){var $=jQuery,Constr,audienceScienceUrl="js.revsci.net/gateway/gw.js",autoTriggerCallback=true,csid="",model={},assignPrivatesVars=function(){csid=model.csid;autoTriggerCallback=model.autoTriggerCallback;audienceScienceUrl=model.audienceScienceUrl;},createAudienceScienceURL=function(){var url=document.location.protocol+"//"+audienceScienceUrl+"?csid="+csid;if(autoTriggerCallback)url=url+"&auto=t";return url;},createAudienceScienceScriptTag=function(){var asUrl=createAudienceScienceURL(),script=document.createElement("script"),sibling;script.id="audienceScienceScript";script.type="text/javascript";script.async="true";script.src=asUrl;sibling=document.getElementsByTagName("script")[0];sibling.parentNode.insertBefore(script,sibling);},defineDMprepClientFunction=function(){window.DM_prepClient=function(csid,client){_.each(model.onPageLoad.addEncToLoc,function(o){client.DM_addEncToLoc(o.name,o.value);});};},sendData=function(){$("audienceScienceScript").remove();createAudienceScienceScriptTag();},sendKeyValuePair=function(o){window.DM_prepClient=function(csid,client){client.DM_addEncToLoc(o.name,o.value);};sendData();},triggerCustomEvent=function(eventName){if(model.customEvents[eventName]===undefined){throw"AURORA.audienceScienceManager requires all custom event defined in the page bootstatp. Missing event: "+eventName;}
window.DM_prepClient=function(csid,client){_.each(model.customEvents[eventName].addEncToLoc,function(o){client.DM_addEncToLoc(o.name,o.value);});};sendData();};Constr=function(model){this.elements=this.initialise(model);};Constr.prototype={constructor:AURORA.audienceScienceManager,initialise:function(pageModel){model=pageModel;assignPrivatesVars();defineDMprepClientFunction();createAudienceScienceScriptTag();},sendKeyValuePair:sendKeyValuePair,triggerCustomEvent:triggerCustomEvent};return Constr;}(jQuery,this));AURORA.nameSpace.create('AURORA.BubbleHelp');AURORA.BubbleHelp=mp.View.extend({options:{targetClasses:[],bubbleTimeout:3000,bubbleContentDataAttributeName:'tooltip',templates:{}},init:function(){this._bindTargets(this.options.targetClasses);this._createBubbleElOnce();},addTargetClasses:function(classNames){this._bindTargets(classNames);_.each(classNames,_.bind(function(className){this.options.targetClasses.push(className);},this));},rebindAllTargetClasses:function(){this._unbindTargets(this.options.targetClasses);this._bindTargets(this.options.targetClasses);},_bindTargets:function(targetClasses){_.each(targetClasses,function(className){var target=$("."+className);target.bind('mouseenter',_.bind(function(evt){this._showBubble(evt);},this));$("."+className+" *").bind('mouseenter',_.bind(function(evt){this._showBubble(evt);},this));target.bind('mouseleave',_.bind(function(){this._hideBubble();},this));_.each(target,function(elem){$(elem).bind('mousemove',{customTimeout:$(elem).data('bubble-timeout')},_.bind(function(evt){this._restartHideTimeout(evt);},this));},this);},this);},_unbindTargets:function(targetClasses){_.each(targetClasses,function(className){$("."+className).unbind();});},_showBubble:function(evt){var tagIsChild=true,target=$(evt.target);_.each(this.options.targetClasses,function(className){if(target.hasClass(className)){tagIsChild=false;}});if(tagIsChild){var depth=0;while(target.data(this.options.bubbleContentDataAttributeName)===undefined&&depth!==3){target=target.parent();depth++;}}
var bubbleContent=target.data(this.options.bubbleContentDataAttributeName),model={"content":bubbleContent},useNamedTemplate=target.data('bubble-template')||false;if(_.isString(bubbleContent)){if(bubbleContent.length===0)return;}
if(bubbleContent===undefined)return;this.render(model,useNamedTemplate);this.$el.css(this._bubbleCssPosition(evt,target));this.$el.show();this._restartHideTimeout(target);},_hideBubble:function(){this.$el.hide();},_bubbleCssPosition:function(evt,target){var pageX=evt.pageX,targetTop=target.offset().top,theScrollTop=$(window).scrollTop(),bubbleHeight=this.$el.height(),cssObj={'top':targetTop-30-theScrollTop-bubbleHeight,'left':pageX-10};return cssObj;},_restartHideTimeout:function(evt){var timeOut;if(evt.data.customTimeout!==undefined){timeOut=evt.data.customTimeout;}else{timeOut=this.options.bubbleTimeout;}
clearTimeout(this.timeOut);this.timeOut=setTimeout(_.bind(function(){this._hideBubble();},this),timeOut);},_template:'<div id="bubble-help" class="bubble-help info" style="display:none"></div>',_createBubbleElOnce:function(){if($('#bubble-help').length===0){$(document.body).append($(this._template));this.setElement($('#bubble-help'));}},render:function(model,useNamedTemplate){if(!useNamedTemplate){this.$el.html(model.content);}else{this.$el.html(Mustache.render(this.options.templates[useNamedTemplate],model.content));}}});AURORA.nameSpace.create("AURORA.templates");AURORA.templates.vipPremiumContentRightDialog=unescape("%3Cimg%20src%3D%22http%3A//ad-emea.doubleclick.net/ad/N2136.272910.MARKPLAATS.NL/B6856980.5%3Bsz%3D1x1%3Bord%3D%25n%3F%22%20width%3D%221%22%20height%3D%221%22%20border%3D%220%22%20style%3D%22float%3A%20right%22%20/%3E%3Cdiv%20class%3D%22premium-content-disclaimer-large%22%3ELet%20op%21%20Geld%20lenen%20kost%20geld%3Cimg%20src%3D%22/aurora/res/images/logos/max-large.png%22/%3E%3C/div%3E%3Cimg%20class%3D%22premium-content-logo%20large%22%20src%3D%22/aurora/res/images/logos/logo-abn-amro.png%22%20width%3D%22129%22%20height%3D%2232%22%20/%3E%3Cdiv%20class%3D%22clear-fix%22%3E%3C/div%3E%3Cdiv%20class%3D%22premium-content-popup%20first%22%3E%20%20%20%20%3Ch3%20class%3D%22section-header%22%3EEen%20geschikte%20lening%3C/h3%3E%20%20%20%20%3Cdiv%20class%3D%22section-content%22%3E%20%20%20%20%20%20%20%20Wij%20vinden%20het%20belangrijk%20dat%20uw%20lening%20past.%20Bij%20u%2C%20bij%20uw%20situatie%20en%20%20%20%20%20%20%20%20bij%20uw%20aankoop.%20Hoeveel%20kunt%20u%20lenen%20en%20wat%20betaalt%20u%20voor%20uw%20lening%3F%20%20%20%20%20%20%20%20%3Ca%20target%3D%22_blank%22%20href%3D%22http%3A//ad-emea.doubleclick.net/clk%3B260396929%3B84727900%3Bw%22%20class%3D%22button%20primary%20medium%22%3E%3Cspan%3Ebereken%20uw%20maandlast%3C/span%3E%3C/a%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%3C/div%3E%3Cdiv%20class%3D%22premium-content-popup%22%3E%20%20%20%20%3Ch3%20class%3D%22section-header%22%3EVerstandig%20lenen%20bij%20ABN%20AMRO%3C/h3%3E%20%20%20%20%3Cdiv%20class%3D%22section-content%22%3E%20%20%20%20%20%20%20%20Bij%20ABN%20AMRO%20helpen%20wij%20u%20niet%20alleen%20met%20het%20kiezen%20van%20een%20lening.%20%20%20%20%20%20%20%20Mocht%20uw%20situatie%20in%20de%20toekomst%20onverwachts%20veranderen%2C%20dan%20staan%20wij%20ook%20voor%20u%20klaar%20met%20%20%20%20%20%20%20%20oplossingen%20en%20advies.%20%20%20%20%20%20%20%20%3Ca%20target%3D%22_blank%22%20href%3D%22http%3A//ad-emea.doubleclick.net/clk%3B260396948%3B84727927%3Bg%22%20class%3D%22button%20primary%20medium%22%3E%3Cspan%3Eofferte%20aanvragen%3C/span%3E%3C/a%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%3C/div%3E%3Cdiv%20class%3D%22clear-fix%22%3E%3C/div%3E");AURORA.nameSpace.create("AURORA.templates");AURORA.templates.vipPremiumContentLeftDialog=unescape("%3Ciframe%20style%3D%22width%3A%20100%25%3B%20height%3A%20351px%3B%20border%3A%20none%3B%22%20frameBorder%3D%220%22%20scrolling%3D%22no%22%20src%3D%22https%3A//auto.centraalbeheer.nl/marktplaats_auto/indexAutoc.html%3Fkenteken%3D%7B%7BlicensePlate%7D%7D%22%3E%3C/iframe%3E");AURORA.nameSpace.create("AURORA.templates");AURORA.templates.galleryViewImageBubbleText=unescape("%3Cspan%20class%3D%27bubble-title%27%3E%7B%7B%26%20title%7D%7D%3C/span%3E%3Cspan%20class%3D%27bubble-price%27%3E%7B%7B%26%20price%7D%7D%3C/span%3E%3Cspan%20class%3D%27bubble-name%27%3E%7B%7B%26%20sellerName%7D%7D%3C/span%3E%3Cspan%20class%3D%27bubble-location%27%3E%7B%7B%26%20location%7D%7D%3C/span%3E%3Cspan%20class%3D%27bubble-distance%27%3E%7B%7B%26%20distance%7D%7D%3C/span%3E");AURORA.nameSpace.create("AURORA.templates");AURORA.templates.casAdBlock=unescape("%3Cdiv%20id%3D%27cas-listing-title%27%3E%20%20%20%20%3Ch2%3E%7B%7Btitle%7D%7D%3C/h2%3E%3C/div%3E%3Cdiv%20id%3D%27cas-listing-container%27%3E%20%20%20%20%7B%7B%23snippets%7D%7D%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cas-listing%27%20data-ad-url%3D%27%7B%7BvipUrl%7D%7D%27%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22cas-listing-img%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cimg%20src%3D%27%7B%7BprimaryImageUrl%7D%7D%27/%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22cas-listing-text%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cas-listing-title%27%3E%7B%7Btitle%7D%7D%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cas-listing-detail%27%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cas-listing-price%27%3E%7B%7BformattedPrice%7D%7D%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%7B%23showLocation%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cas-listing-location%27%3E%7B%7BlocationDescription%7D%7D%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%7B/showLocation%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%7B%7B/snippets%7D%7D%3C/div%3E");AURORA.nameSpace.create('AURORA.casAdBlock');var Mustache=Mustache||{};AURORA.casAdBlock=mp.View.extend({options:{ajaxCache:false,orientation:"vertical"},events:{"click .cas-listing":"_handleCasListingClick","click .cas-on-top-listing":"_handleCasOnTopListingClick"},init:function(){this.model.bind('change',this.render,this);this.model.fetch({cache:this.options.ajaxCache});},_handleCasListingClick:function(evt){document.location=$(evt.target).closest('.cas-listing').data('ad-url');},_handleCasOnTopListingClick:function(evt){document.location=$(evt.target).closest('.cas-on-top-listing').data('ad-url');},render:function(){var modelJson=this.model.toJSON(),numberOfListings=modelJson.casAds.snippets.length;if(numberOfListings>0){var template=(this.options.orientation==="vertical")?AURORA.templates.casAdBlock:AURORA.templates.casHorizontalAdBlock,html=Mustache.to_html(template,modelJson.casAds);$(this.el).html(html);$(this.el).show();}else{$(this.el).hide();}}});AURORA.casAdBlockModel=mp.Model.extend({fetch:function(options){options.cache=false;return mp.Model.prototype.fetch.call(this,options);}});AURORA.nameSpace.create("AURORA.templates");AURORA.templates.flaggingReasonsOptions=unescape("%7B%7B%23reasons%7D%7D%20%20%20%20%3Cinput%20id%3D%27reason-%7B%7Bid%7D%7D%27%20type%3D%27radio%27%20name%3D%27reason%27%20class%3D%27flagging-reason%27%20value%3D%27%7B%7Bid%7D%7D%27%20data-selectable%3D%27%7B%7Bselectable%7D%7D%27%20data-category-selection%3D%27%7B%7BcategorySelectionPresent%7D%7D%27%20/%3E%20%20%20%20%3Clabel%20for%3D%27reason-%7B%7Bid%7D%7D%27%3E%20%20%20%20%20%20%20%20%7B%7Blabel%7D%7D%20%20%20%20%20%20%20%20%7B%7B%23moreInfoUrl%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%28%3Ca%20href%3D%27%7B%7BmoreInfoUrl%7D%7D%27%20rel%3D%27nofollow%27%20target%3D%27_blank%27%3Elees%20meer%3C/a%3E%29%20%20%20%20%20%20%20%20%7B%7B/moreInfoUrl%7D%7D%20%20%20%20%3C/label%3E%20%20%20%20%3Cbr%20/%3E%20%20%20%20%3Cdiv%20class%3D%27flagging-sub-reasons-container%27%20id%3D%27sub-reasons-%7B%7Bid%7D%7D%27%3E%20%20%20%20%20%20%20%20%7B%7B%23subTextPresent%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%7B%7B%5EcategorySelectionPresent%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20class%3D%27reason-subtext%27%3E%7B%7BsubText%7D%7D%3C/span%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cbr%20/%3E%20%20%20%20%20%20%20%20%20%20%20%20%7B%7B/categorySelectionPresent%7D%7D%20%20%20%20%20%20%20%20%7B%7B/subTextPresent%7D%7D%20%20%20%20%20%20%20%20%7B%7B%23subreasons%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type%3D%27radio%27%20name%3D%27sub-reason%27%20class%3D%27flagging-sub-reason%27%20value%3D%27%7B%7Bid%7D%7D%27%20%20%20%20%20%20%20%20%20%20%20%20id%3D%27sub-reason-%7B%7Bid%7D%7D%27/%3E%3Clabel%20for%3D%27sub-reason-%7B%7Bid%7D%7D%27%3E%7B%7Blabel%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%7B%23moreInfoUrl%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%3Ca%20href%3D%27%7B%7BmoreInfoUrl%7D%7D%27%20rel%3D%27nofollow%27%20target%3D%27_blank%27%3Elees%20meer%3C/a%3E%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%7B/moreInfoUrl%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/label%3E%20%20%20%20%20%20%20%20%20%20%20%20%7B%7B%23userMessageRequired%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type%3D%27text%27%20name%3D%27reason-user-message%27%20%20%20%20%20%20%20%20%20%20%20%20id%3D%27reason-user-message%27%20data-sub-reason%3D%27%7B%7Bid%7D%7D%27%20maxlength%3D%27500%27%20disabled%3D%27true%27%20/%3E%20%20%20%20%20%20%20%20%20%20%20%20%7B%7B/userMessageRequired%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%3Cbr%20/%3E%20%20%20%20%20%20%20%20%7B%7B/subreasons%7D%7D%20%20%20%20%3C/div%3E%7B%7B/reasons%7D%7D");AURORA.nameSpace.create("AURORA.templates");AURORA.templates.flaggingCategoryOptions=unescape("%3Cdiv%20id%3D%27catagoryOption%27%3E%20%20%20%20%3Cspan%20class%3D%27wrong-category-subtext%27%3EUw%20melding%20wordt%20sneller%20verwerkt%20als%20u%20kunt%20aangeven%20wat%20de%20juiste%20rubriek%20is.%3C/span%3E%20%20%20%20%3Cbr%20/%3E%20%20%20%20Groep%20%20%20%20%3Cbr%20/%3E%20%20%20%20%3Cselect%20id%3D%27l1Categories%27%3E%20%20%20%20%20%20%20%3Coption%20value%3D%27%27%3ESelecteer%3C/option%3E%20%20%20%20%20%20%20%20%7B%7B%23categories%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%3Coption%20value%3D%27%7B%7Bid%7D%7D%27%20%7B%7Bstate%7D%7D%20%3E%7B%7Bname%7D%7D%3C/option%3E%20%20%20%20%20%20%20%20%7B%7B/categories%7D%7D%20%20%20%20%3C/select%3E%20%20%20%20%3Cbr%20/%3E%20%20%20%20Rubriek%20%20%20%20%3Cbr%20/%3E%20%20%20%20%3Cselect%20id%3D%27l2Categories%27%3E%20%20%20%20%20%20%20%3Coption%20value%3D%27%27%3ESelecteer%3C/option%3E%20%20%20%20%20%20%20%20%7B%7B%23subCategories%7D%7D%20%20%20%20%20%20%20%20%20%20%20%20%3Coption%20value%3D%27%7B%7Bid%7D%7D%27%20class%3D%27l2-categories-option%27%3E%7B%7Bname%7D%7D%3C/option%3E%20%20%20%20%20%20%20%20%7B%7B/subCategories%7D%7D%20%20%20%20%3C/select%3E%3C/div%3E");AURORA.flaggingPopUpModel=mp.Model.extend({sync:AURORA.authenticatedSync});AURORA.flaggingCategoryModel=mp.Model.extend({});AURORA.nameSpace.create('AURORA.flagginCategoryView');var Mustache=Mustache||{};AURORA.flagginCategoryView=mp.View.extend({options:{currentL1Category:0,currentL2Category:0},events:{"change #l1Categories":"_loadL2Categories","change #l2Categories":"_publishL2SelectEvent"},init:function(){this._loadCategoryData(1,1,this.render);},_loadL2Categories:function(evt){var categoryId=parseInt($(evt.target).val(),10);if(categoryId>0){this.options.currentL1Category=categoryId;this._loadCategoryData(2,categoryId,this.render);}else{$('.l2-categories-option').remove();}
mp.PubSub.publish('flagging:l1-category-selected');},_loadCategoryData:function(level,categoryId,callback){switch(level){case 1:this.categoryL1Model=new AURORA.flaggingCategoryModel({});this.categoryL1Model.url='/data/categories/0/-1/-1.json';this.categoryL1Model.parse=this._parseL1CategoryData;this.categoryL1Model.bind('change',callback,this);this.categoryL1Model.fetch();break;case 2:this.categoryL2Model=new AURORA.flaggingCategoryModel({});this.categoryL2Model.url='/data/categories/l2/'+categoryId+'.json';this.categoryL2Model.parse=this._parseL2CategoryData;this.categoryL2Model.bind('change',callback,this);this.categoryL2Model.fetch();mp.PubSub.publish('flagging:l2-category-loaded');break;case 3:this.categoryL3Model=new AURORA.flaggingCategoryModel({url:'/data/categories/0/-1/'+categoryId+'.json'});this.categoryL3Model.fetch();break;default:}},_parseL1CategoryData:function(resp,xhr){return{categories:resp[0].items};},_parseL2CategoryData:function(resp,xhr){return{subCategories:resp};},_publishL2SelectEvent:function(evt){this.options.currentL2Category=$(evt.target).val();mp.PubSub.publish('flagging:l2-category-selected');},render:function(){var theModel=this.categoryL1Model.toJSON(),l1CategoriesWithSelectedState=[];_.each(this.categoryL1Model.toJSON().categories,_.bind(function(cat){var state='';if(parseInt(cat.id,10)===this.options.currentL1Category){state='selected';}
l1CategoriesWithSelectedState.push({id:cat.id,name:cat.name,state:state});},this));theModel={categories:l1CategoriesWithSelectedState};if(this.categoryL2Model){theModel.subCategories=this.categoryL2Model.toJSON().subCategories;}
$(this.el).html(Mustache.to_html(AURORA.templates.flaggingCategoryOptions,theModel));}});AURORA.nameSpace.create('AURORA.flaggingPopUp');var Mustache=Mustache||{};AURORA.flaggingPopUp=mp.View.extend({_messageRequiredId:null,_dialogIsRendered:false,options:{flaggingButtonEl:null,flaggingOptionsEl:null,flaggingFormSubmitButton:$('#flagging-form-submit-button'),autoCenter:true,observers:{'flagging:l1-category-selected':'_disableSubmitButton','flagging:l2-category-loaded':'_disableSubmitButton','flagging:l2-category-selected':'_updateUserMessageWithCategoryId'}},events:{"submit form":"_handleTippingFormSubmit","click .flagging-reason":"_handleReasonClick","click .flagging-sub-reason":"_handleSubReasonClick","keyup #reason-user-message":"_handleUserMessageKeyUp"},_bindEventsOutsideThisEl:function(){this.options.flaggingButtonEl.bind('click',_.bind(this._handleShowDialogClick,this));if(this.options.autoCenter){$(window).bind('resize',_.bind(_.debounce(this._positionDialog,300),this));$(window).bind('scroll',_.bind(_.debounce(this._positionDialog,300),this));}},init:function(){this._bindEventsOutsideThisEl();mp.PubSub.subscribe('flagging:l2-catagory-selected');},_handleShowDialogClick:function(){if(this._dialogIsRendered){this.getChildView('flagging-dialog').show();}else{this._initializeDialog();}},_handleSubReasonClick:function(event){if(this._messageRequiredId===parseInt($(event.target).val(),10)&&$('#reason-user-message').val().length===0){this._disableSubmitButton();}else{this._enableSubmitButton();}
if(this._messageRequiredId===parseInt($(event.target).val(),10)){$('#reason-user-message').prop('disabled',false).focus();}else{$('#reason-user-message').prop('disabled',true);}
this.model.set({selectedReasonId:$(event.target).val()},{silent:true});},_handleReasonClick:function(event){var clickedOption=$(event.target),reasonId=clickedOption.val(),isSelectable=clickedOption.data('selectable'),requiresCategorySelection=clickedOption.data('category-selection');if(requiresCategorySelection){if($('#catagoryOptions').length===0){clickedOption.next().after("<div id='catagoryOptions'></div>");this.appendChildView('categoryOption',new AURORA.flagginCategoryView({el:$('#catagoryOptions')}));this.model.set({selectedReasonId:reasonId},{silent:true});}else{$('#catagoryOptions').show();}}else{if(this.getChildView('categoryOption')){this.getChildView('categoryOption').remove();$('#reason-user-message').val('');}}
if(isSelectable&&!requiresCategorySelection){this.model.set({selectedReasonId:reasonId},{silent:true});this._enableSubmitButton();}else{this._disableSubmitButton();}
$('.flagging-sub-reasons-container').hide();$('#sub-reasons-'+reasonId).show();this._positionDialog();},_handleUserMessageKeyUp:function(){if(this._messageRequiredId===parseInt(this.model.get('selectedReasonId'),10)&&$('#reason-user-message').val().length===0){this._disableSubmitButton();}else{this._enableSubmitButton();}},_handleTippingFormSubmit:function(event){var selectedReasonId=this.model.get('selectedReasonId'),modelAttributesToSave={itemIds:[$('#flagging-adUrn').val()],token:$('input[name="nl.marktplaats.xsrf.token"]').val(),userMessage:$('#reason-user-message').val()};if(parseInt(selectedReasonId,10)===this._messageRequiredId){modelAttributesToSave.userMessage=$('#reason-user-message').val();}
event.preventDefault();this.getChildView('flaggingLoadingOverlay').display();this.model.save(modelAttributesToSave,{success:_.bind(this._onSuccessCallback,this),error:_.bind(this._onErrorCallback,this)});},_onSuccessCallback:function(model,response){if(response.valid){this.getChildView('flaggingLoadingOverlay').hide();this.getChildView('flaggingSuccessOverlay').display();_.delay(_.bind(function(){this.getChildView('flaggingSuccessOverlay').hide();this.getChildView('flagging-dialog').hide();$('#flagging-feedback-header').html(mp.msg(response.messages.header));$('#flagging-feedback-item').html(mp.msg(response.messages.messages[0].key));$('#msg-success-flagging').fadeIn('fast');window.scrollTo(0,$('#msg-success-flagging').position().top);this.model.unset('errors');this.model.unset('valid');this.model.unset('callback');this.model.unset('messages');},this),1000);}},_onErrorCallback:function(){this.getChildView('flaggingLoadingOverlay').hide();this.getChildView('flagging-dialog').hide();},_initializeDialog:function(){this._createDialogAndOverlaysOnce();this.getChildView('flagging-dialog').show();this.getChildView('flaggingLoadingOverlay').display();this.model.set({token:$('input[name="nl.marktplaats.xsrf.token"]').val()});this.model.bind('change',this.render,this);this.model.fetch();},_createDialogAndOverlaysOnce:function(){if(!_.isObject(this.getChildView('flagging-dialog'))){this.appendChildView('flagging-dialog',new mp.Dialog({el:$(this.el),modal:true}));this.appendChildView('flaggingLoadingOverlay',new mp.Overlay({el:$(this.el).find('.overlay-loader'),target:this.el}));this.appendChildView('flaggingSuccessOverlay',new mp.Overlay({el:$(this.el).find('.overlay-success'),target:this.el}));}},_enableSubmitButton:function(){this.options.flaggingFormSubmitButton.removeClass('disabled').removeProp("disabled");},_disableSubmitButton:function(){this.options.flaggingFormSubmitButton.addClass('disabled').prop("disabled","disabled");},_positionDialog:function(){var top=(($(window).height()-$(this.el).height())/2)+$(document).scrollTop();var left=($(document.body).width()-$(this.el).width())/2;$(this.el).animate({'top':top+'px','left':left+'px'});},_updateUserMessageWithCategoryId:function(){$('#reason-user-message').val(this.getChildView('categoryOption').options.currentL2Category);this._enableSubmitButton();},render:function(){var html=Mustache.to_html(AURORA.templates.flaggingReasonsOptions,{reasons:this.model.get('reasons')});this.getChildView('flaggingLoadingOverlay').hide();this.options.flaggingOptionsEl.html(html);this._messageRequiredId=$('#reason-user-message').data('sub-reason');this._positionDialog();this.model.unbind('change',this.render,this);this._dialogIsRendered=true;}});AURORA.nameSpace.create("AURORA.templates");AURORA.templates.ryiUpsellDialog=unescape("%3Cdiv%20class%3D%22content%22%3E%20%20%20%20%3Cspan%20class%3D%22close%22%3E%3C/span%3E%20%20%20%20%3Ch3%20class%3D%22title%22%3EOpvallen%3C/h3%3E%20%20%20%20%3Cdiv%20class%3D%22canvas%22%3E%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22upsell-ad-info%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22upsell-adImage%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22%7B%7Bimage%7D%7D%22%20height%3D%2264px%22%20width%3D%2264px%22/%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22upsell-ad-title%22%3E%7B%7Btitle%7D%7D%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22upsell-ad-count%22%3E%7B%7BadCount%7D%7D%3C/div%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3Cform%20id%3D%22upsell-form%22%20method%3D%22post%22%20action%3D%22/ryi/opvalmogelijkheden.html%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cfieldset%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22upsell-items%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22upsell-item%22%20id%3D%22top-ad-item%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type%3D%22checkbox%22%20id%3D%22top-ad%22%20class%3D%22checkbox%22%20value%3D%22true%22%20name%3D%22topAd%22/%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Clabel%20class%3D%22item-heading%22%3ETopadvertentie%20-%20%26euro%3B%20%7B%7BtopAdPrice%7D%7D%3C/label%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22clear%3A%20both%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22item-heading%20sub-heading%22%3EExtra%20zichtbaar%20bovenaan%20de%20pagina%27s%3C/span%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cul%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%3E%3Cspan%3EOnderscheidt%20uw%20advertentie%20van%20andere%20advertenties.%3C/span%3E%3C/li%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%3E%3Cspan%3EStaat%207%20dagen%20boven%20de%20standaard%20advertenties%20op%20de%20eerste%20pagina%27s.%3C/span%3E%3C/li%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%3E%3Cspan%3EIs%20ideaal%20voor%20professionele%20verkopers.%3C/span%3E%3C/li%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/ul%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22upsell-item%22%20id%3D%22dagtopper-item%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type%3D%22checkbox%22%20id%3D%22dagtopper%22%20class%3D%22checkbox%22%20value%3D%22true%22%20name%3D%22dagtopper%22%20/%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Clabel%20class%3D%22item-heading%22%3EDagtopper%20-%20%26euro%3B%20%7B%7BdagTopperPrice%7D%7D%3C/label%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22clear%3A%20both%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22item-heading%20sub-heading%22%3EStart%20boven%20de%20standaard%20advertenties%3C/span%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cul%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%3E%3Cspan%3EStaat%20gegarandeerd%201%20dag%20boven%20de%20standaard%20advertenties.%3C/span%3E%3C/li%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%3E%3Cspan%3EWordt%20sneller%20gevonden%20en%20meer%20bekeken.%3C/span%3E%3C/li%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%3E%3Cspan%3EIs%20ideaal%20om%20uw%20verkoop%20voor%201%20dag%20een%20boost%20te%20geven.%3C/span%3E%3C/li%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/ul%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22upsell-item%22%20id%3D%22up-call-item%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type%3D%22checkbox%22%20id%3D%22up-call%22%20class%3D%22checkbox%22%20value%3D%22true%22%20name%3D%22upcall%22/%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Clabel%20class%3D%22item-heading%22%3EOmhoogplaatsen%20-%20%26euro%3B%20%7B%7BupsellPrice%7D%7D%3C/label%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20style%3D%22clear%3A%20both%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22item-heading%20sub-heading%22%3EStart%20opnieuw%20als%20standaard%20advertentie%3C/span%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cul%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%3E%3Cspan%3EUw%20advertentie%20begint%20opnieuw%20bovenaan%20als%20standaard%20advertentie.%3C/span%3E%3C/li%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cli%3E%3Cspan%3EUw%20advertentie%20zakt%20naar%20beneden%20wanneer%20nieuwe%20advertenties%20worden%20geplaatst.%3C/span%3E%3C/li%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/ul%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/fieldset%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type%3D%22hidden%22%20name%3D%22advertisementId%22%20value%3D%22%7B%7BadvertisementId%7D%7D%22/%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type%3D%22hidden%22%20name%3D%22nl.marktplaats.xsrf.token%22%20value%3D%22%7B%7Btoken%7D%7D%22/%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22clear-fix%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20id%3D%22upsell-buttons-wrapper%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20id%3D%22upsell-submit-button%22%20class%3D%22button%20primary%20medium%20disabled%22%20data-ga-track-event%3D%22RYI%2CFeature%20Overlay%2Cselect%20feature%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%3ENaar%20Betalen%3C/span%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/a%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20id%3D%22upsell-cancel-button%22%20class%3D%22button%20secondary%20medium%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%3EAnnuleren%3C/span%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/a%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3C/form%3E%20%20%20%20%3C/div%3E%20%20%20%20%3Cdiv%20class%3D%22overlay-success%20overlayed%22%3E%3C/div%3E%3C/div%3E%3Cdiv%20class%3D%22opacity-frame%22%3E%3C/div%3E");AURORA.UpsellPopupViewModel=mp.Model.extend({sync:AURORA.authenticatedSync});AURORA.UpsellPopupView=mp.View.extend({dependencyList:{Dialog:mp.Dialog,Overlay:mp.Overlay},options:{upsellFormSubmitButton:$('#upsell-submit-button'),autoCenter:true,submitHandler:null,onShow:mp.emptyFunction,onHide:mp.emptyFunction},events:{"click #dagtopper-item":'selectItem',"click #top-ad-item":'selectItem',"click #up-call-item":'selectItem',"click #micro-tip-item":'selectItem',"click #micro-tip-text":'stopPropagation',"click #upsell-cancel-button":'close'},init:function(){$(window).bind('resize',_.bind(_.debounce(this._positionDialog,300),this));if(this.options.autoCenter){$(window).bind('scroll',_.bind(_.debounce(this._positionDialog,300),this));}},initMicroTip:function(){var microTipText=this.$el.find("#micro-tip-text");if(microTipText.length===0){return;}
var microTip=new mp.MicroTip({});mp.PubSub.subscribe("microtip-illegal-string",_.bind(function(){this._disableSubmitButton();},this));mp.PubSub.subscribe("microtip-correct-string",_.bind(function(){this._manageSubmitButtonState();},this));},stopPropagation:function(evt){evt.stopPropagation();},selectItem:function(evt){var clickRow=$(evt.target).closest('.upsell-item'),checkBoxWasCheckedBeforeClick;if($(evt.target).hasClass('checkbox')){checkBoxWasCheckedBeforeClick=!$(evt.target).prop('checked');}else{checkBoxWasCheckedBeforeClick=clickRow.find('input').prop('checked');if(checkBoxWasCheckedBeforeClick){clickRow.find('input').prop('checked',false);}else{clickRow.find('input').prop('checked',true);}}
if(checkBoxWasCheckedBeforeClick){clickRow.removeClass('selected');}else{clickRow.addClass('selected');}
this._manageSubmitButtonState();},submitForm:function(){_.delay(_.bind(function(){$('#upsell-form').submit();},this),100);},close:function(){this.getChildView('upsell-dialog').hide();},open:function(){this._createDialogAndOverlaysOnce();this.model.set({token:$('input[name="nl.marktplaats.xsrf.token"]').val()});this.render();this.getChildView('upsell-dialog').show();this.initMicroTip();mp.PubSub.publish("myAds:upsellDialogOpened");},_createDialogAndOverlaysOnce:function(){var self=this;if(!_.isObject(this.getChildView('upsell-dialog'))){this.appendChildView('upsell-dialog',new this.dependencies.Dialog({el:$(this.el),modal:true,onHide:function(){self.options.onHide();},onShow:function(){self.options.onShow();}}));this.appendChildView('upsellLoadingOverlay',new this.dependencies.Overlay({el:$(this.el).find('.overlay-loader'),target:this.el}));this.appendChildView('upsellSuccessOverlay',new this.dependencies.Overlay({el:$(this.el).find('.overlay-success'),target:this.el}));}},_manageSubmitButtonState:function(){var topAdChecked=this.$el.find('#top-ad').prop("checked"),microTipChecked=this.$el.find('#micro-tip').prop("checked"),dagtopperTipChecked=this.$el.find('#dagtopper').prop("checked"),upCallTipChecked=this.$el.find('#up-call').prop("checked"),microTipText,microTipPlaceHolder,microTipTextValid=false;if(this.$el.find('#micro-tip-text').length>0){microTipText=this.$el.find('#micro-tip-text').val();microTipPlaceHolder=this.$el.find('#micro-tip-text').data('placeholder');microTipTextValid=(microTipText.length>0&&microTipText!==microTipPlaceHolder);}
if(((topAdChecked||dagtopperTipChecked||upCallTipChecked)&&!microTipChecked)||(microTipChecked&&microTipTextValid)){this._enableSubmitButton();}else{this._disableSubmitButton();}},_enableSubmitButton:function(){if(!this.options.submitHandler){$('#upsell-submit-button').click(this.submitForm);}else{$('#upsell-submit-button').click(this.options.submitHandler);}
$('#upsell-submit-button').removeClass('disabled').removeProp("disabled");},_disableSubmitButton:function(){$('#upsell-submit-button').addClass('disabled').prop("disabled","disabled");$('#upsell-submit-button').off("click");},_positionDialog:function(){var top=(($(window).height()-$(this.el).height())/2)+$(document).scrollTop();var left=($(document.body).width()-$(this.el).width())/2;$(this.el).animate({'top':top+'px','left':left+'px'});},disableTopAdItem:function(){$(this.el).undelegate('#top-ad-item','click');$('#top-ad-item').addClass("disabled");$("#top-ad").attr('disabled','disabled');},render:function(){var html=Mustache.to_html(this.options.template,this.model.toJSON());$(this.el).html(html);this._positionDialog();if(this.model.attributes.isTopAdActive||!this.model.attributes.isTopAdEnabled){this.disableTopAdItem();}
AURORA.googleAnalyticsManagerInstance.trackOperationsOnLoadOf($(this.el));}});mp.Bids=mp.View.extend({options:{},events:{"click .vip-bids-toggle a":"toggleMore","submit #vip-bidding-form":"bid","click .vip-bid-remove-form a":"remove"},init:function(){this.preventBidding=false;this.attachBidInput();this.shortenPrice();var bidListingBlock=$('#vip-list-bids-block .canvas');this.appendChildView('bidLoadingOverlay',new mp.Overlay({el:$('#vip-list-bids-block .overlay-loader'),target:bidListingBlock}));this.appendChildView('bidSuccessOverlay',new mp.Overlay({el:$('#vip-list-bids-block .overlay-success'),target:bidListingBlock}));this.appendChildView('bidErrorOverlay',new mp.Overlay({el:$('#vip-list-bids-block .overlay-error'),target:bidListingBlock}));mp.PubSub.subscribe('price-type:remove-bids-combination',_.bind(this.hide,this));},hide:function(){$(this.el).hide();},attachTooltips:function(){$(".vip-bids tr").each(function(){var tip=new mp.Tooltip({target:$(this)});});},attachBidInput:function(){this.bidInput=new mp.BidInput({el:this.$("input[name='amount']")});},toggleMore:function(){$("#vip-bids-more").parent().stop().slideToggle(350,function(){$(this).height("auto");});$(".vip-bids-toggle").toggle();},bid:function(event){event.preventDefault();var valid=this.bidInput.validateOnClick();if(valid){this.getChildView('bidLoadingOverlay').display();var form=$("#vip-bidding-form");AURORA.googleAnalyticsManagerInstance.fireOperationsOnSubmit(form);if(this.preventBidding)return;this.preventBidding=true;$('#vip-bidding-button').addClass('disabled');this.post(form,function(){AURORA.googleAnalyticsManagerInstance.fireOperationsOnSuccess(form);if(AURORA.audienceScienceManagerInstance!==undefined){AURORA.audienceScienceManagerInstance.triggerCustomEvent('placeBid');}});}},remove:function(event){var form=$(event.target).closest("form");AURORA.googleAnalyticsManagerInstance.fireOperationsOnSubmit(form);event.preventDefault();this.post(form,function(){AURORA.googleAnalyticsManagerInstance.fireOperationsOnSuccess(form);});},post:function(form,successCallback){$.post(form.attr("action"),form.serialize(),_.bind(function(html){this.render(html,successCallback);},this));},shortenPrice:function(){$('#vip-place-bid-block h4 > span').css('font-size','14px');$(".vip-bid-amount-buyer-view, .vip-bid-amount-default-view, .vip-bid-amount-seller-view").each(function(){var elementHtml=$(this).html(),elementHtmlStrLen=elementHtml.length;if(elementHtmlStrLen>10){$(this).html(elementHtml.substring(0,elementHtmlStrLen-3));$('#vip-place-bid-block h4 > span').css('font-size','12px');}});},stripWhiteSpace:function(html){return html.replace(/^\s+|\s+$/g,'');},render:function(html,successCallback){html=$(this.stripWhiteSpace(html));this.preventBidding=false;$("#bids-overview").html(html.filter("#bids-overview").html());this.shortenPrice();this.getChildView('bidLoadingOverlay').hide();if(html.filter(".message").hasClass('success')){this.getChildView('bidSuccessOverlay').display();_.delay(_.bind(function(){this.getChildView('bidSuccessOverlay').hide();},this),500);}
if(html.filter(".message").hasClass('error')){var errorMessageHtml=this.stripWhiteSpace(html.filter(".message").html());var errorBody=$(this.stripWhiteSpace($(errorMessageHtml).filter('ul').html())).filter('li').html();$(this.getChildView('bidErrorOverlay').el).html(this.stripWhiteSpace(errorBody));this.getChildView('bidErrorOverlay').display();_.delay(_.bind(function(){this.getChildView('bidErrorOverlay').hide();},this),10000);}
var minBid=$(_.find(html,function(obj){return obj.id==="bids-overview";})).data("current-top-bid-formatted");$("#vip-bidding-form-min-bid").text(minBid);if($('#ryi-number-of-bids').length===1){var numberOfBids=parseInt($('#ryi-number-of-bids').html(),10)-1;$('#ryi-number-of-bids').html(numberOfBids);mp.PubSub.publish('bids:ryi-bids-removed');}
$(this.bidInput.el).val("");$(this.bidInput.el).blur();successCallback();$('#vip-bidding-button').removeClass('disabled');var currentTopBid=0;if(this.$(".vip-bids").data("current-top-bid")!==undefined){currentTopBid=this.$(".vip-bids").data("current-top-bid");}
$(this.bidInput.el).data("current-top-bid",currentTopBid);this.attachBidInput();var mediaplexUrlsString=$(_.find(html,function(obj){return obj.id==="bids-overview";})).data("mediaplex-url");if(mediaplexUrlsString!==undefined){var mediaplexUrls=mediaplexUrlsString.split(',');_.each(mediaplexUrls,function(mediaplexUrl){if(mediaplexUrl&&(mediaplexUrl!==undefined)&&(mediaplexUrl.length!==0)){AURORA.Analytics.load('mediaplex',mediaplexUrl);}});}}});AURORA.nameSpace.create("AURORA.templates");AURORA.templates.adsenseVip=unescape("%3Csmall%3EAdvertenties%20door%20Google%3C/small%3E%3Cul%3E%20%20%20%20%7B%7B%23ads%7D%7D%20%20%20%20%20%20%20%20%3Cli%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20href%3D%22%7B%7B%7Burl%7D%7D%7D%22%20target%3D%22_blank%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22adsense-title%22%3E%7B%7B%7Bline1%7D%7D%7D%3C/span%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22adsense-lines%22%3E%7B%7B%7Bline2%7D%7D%7D%3C/span%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cspan%20class%3D%22adsense-url%22%3E%7B%7B%7Bvisible_url%7D%7D%7D%3C/span%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/a%3E%20%20%20%20%20%20%20%20%3C/li%3E%20%20%20%20%7B%7B/ads%7D%7D%3C/ul%3E");AURORA.AdsenseBlock=mp.View.extend({options:{template:null,postRenderCallback:null,searchQuery:''},init:function(){this.render();this.$el.find('table.mp-adsense-search-results tr').click(this.handleBackgroundDivClick);},render:function(){if(this.model.length>0){var html=Mustache.to_html(this.options.template,{ads:this.model,searchQuery:this.options.searchQuery});this.$el.html(html);this.$el.show();if(_.isFunction(this.options.postRenderCallback)){this.options.postRenderCallback.apply(this);}}},handleBackgroundDivClick:function(evt){if($(evt.target).prop('tagName').toLowerCase()!=="a"){window.open($(this).data('url'));return false;}}});AURORA.nameSpace.create('AURORA.HeaderMenu');AURORA.HeaderMenu=mp.View.extend({isSideMenuVisible:false,events:{'touchstart #mp-menu':'_shiftMenu','MSPointerDown #mp-menu':'_shiftMenu','touchstart #header *':'_preventClick','touchstart #page-wrapper':'_hideMenu','MSPointerDown #page-wrapper':'_hideMenu','touchstart .side-menu .item':'_gotoLink','click #mp-menu .item':'_gotoLink','click #my-mp-menu-label':'_gotoLink'},init:function(){$('#mp-menu').css('display','inline');if(this.isTouchDevice()){this.$el.find('#mp-menu .item-frame').appendTo('.side-menu');$('.side-menu').css({'visibility':'visible'});}
$('#mp-menu').hover(function(){$(this).addClass('hover');$(this).addClass('open');},function(){$(this).removeClass('hover');$(this).removeClass('open');});},_initMenuCss:function(){$('.side-menu').css({'display':'block'});},_hideMenu:function(event){if(this.isSideMenuVisible){event.stopPropagation();event.preventDefault();this._shiftMenu(event);}},_preventClick:function(event){if(this.isSideMenuVisible){event.preventDefault();}},isTouchDevice:function(){return(('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch);},_shiftMenu:function(event){this._initMenuCss();event.stopPropagation();if(!this.isSideMenuVisible)$('html').toggleClass('accelerate');_.delay(_.bind(function(){$('body').toggleClass('menu-shift');_.delay(_.bind(function(){if(this.isSideMenuVisible)$('html').toggleClass('accelerate');this.isSideMenuVisible=this.isSideMenuVisible!==true;},this),300);},this),100);},_gotoLink:function(event){if($(event.target).data('val')){document.location=$(event.target).data('val');}}});AURORA.PrintVipButton=mp.View.extend({dependencyList:{window:window},options:{template:AURORA.templates.printVip},events:{"click":"_print"},init:function(){this.model.bind('change',function(){this._render();if(!this._isBrowserPrint){this._print();}
this._isBrowserPrint=false;},this);this._bindToBrowserPrint();this._isBrowserPrint=false;this._modelEmpty=true;},_bindToBrowserPrint:function(){var beforePrint=_.bind(this._beforePrint,this);if(this.dependencies.window.matchMedia){var mediaQueryList=this.dependencies.window.matchMedia('print');mediaQueryList.addListener(function(mql){if(mql.matches){beforePrint();}});}
this.dependencies.window.onbeforeprint=beforePrint;},_beforePrint:function(){$(".tooltip").hide();$("#bubble-help").hide();this._isBrowserPrint=true;this._fetchModel();},_fetchModel:function(){if(this._modelEmpty){this.model.fetch({async:false});this._modelEmpty=false;}},_render:function(){var vipModel=this.model.toJSON()[0];if(vipModel.attributes.length===0){vipModel.hasAttributes=false;}else{vipModel.hasAttributes=true;}
if(vipModel.firstPhoto===null){vipModel.firstPhoto="/aurora/res/images/no_photo_medium.png";}
var html=Mustache.to_html(this.options.template,vipModel);$('body').append('<div id="print-page-wrapper"></div>');$('#print-page-wrapper').html(html);},_print:function(){this.dependencies.window.print();}});AURORA.PrintVipModel=mp.Model.extend({});AURORA.nameSpace.create("AURORA.templates");AURORA.templates.sellerOwnAds=unescape("%3Ch2%3E%7B%7Btitle%7D%7D%3C/h2%3E%3Cdiv%20class%3D%27listings%27%3E%20%20%20%20%7B%7B%23snippets%7D%7D%3Ca%20href%3D%27%7B%7BvipUrl%7D%7D%27%20data-ga-track-event%3D%22VIP%2Cseller_own_ads%2C%7B%7BgaEventLabelSellerOtherAds%7D%7D%22%20data-ga-outbound-link%3D%22true%22%3E%20%20%20%20%20%20%20%20%3Cimg%20src%3D%27%7B%7BprimaryImageUrl%7D%7D%27/%3E%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22content%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22header%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ch3%3E%7B%7Btitle%7D%7D%3C/h3%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22price%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%3E%7B%7BformattedPrice%7D%7D%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%3C/a%3E%7B%7B/snippets%7D%7D%3C/div%3E");AURORA.nameSpace.create('AURORA.SellerOwnAds');var Mustache=Mustache||{};AURORA.SellerOwnAds=mp.View.extend({init:function(){var sellerId=this.$el.data('seller-id'),itemId=this.$el.data('ad-id');this.model.url='/vip-other-ads.json?sellerId='+sellerId+'&itemId='+itemId;this.model.bind('change',this.render,this);this.model.fetch({cache:false});},render:function(model){if(model.get('snippets').length!==0){var modelJson=this.model.toJSON(),html=Mustache.to_html(AURORA.templates.sellerOwnAds,modelJson);this.$el.html(html);}else{this.$el.hide();}
AURORA.googleAnalyticsManagerInstance.trackOperationsOnLoadOf($(this.el));},analytics:true});AURORA.InfoIcons=mp.View.extend({dependencyList:{Dialog:mp.Dialog},events:{'click .extended-info':'_showInfoDialog'},init:function(){_.each($('.extended-info'),function(el){this.appendChildView(el.id+'-dialog',new this.dependencies.Dialog({id:el.id+'-dialog',modal:true,width:800,templateData:{title:$(el).data('title'),content:$(el).data('content')}}));},this);},_showInfoDialog:function(evt){evt.preventDefault();this.getChildView(evt.currentTarget.id+'-dialog').show();}});AURORA.SocialMediaPopUp=mp.View.extend({options:{windowOptions:'scrollbars=yes,resizable=yes,toolbar=no,location=yes',width:550,height:440},init:function(){this.$el.on('click',_.bind(this.openPopUp,this));},openPopUp:function(event){var winHeight=screen.height,winWidth=screen.width,target=event.target||event.srcElement,target_check,left,top=0;while(target&&target.nodeName.toLowerCase()!=='a'){target=target.parentNode;}
if(target&&target.nodeName.toLowerCase()==='a'&&target.href){target_check=target.href.match(this.options.intentRegex);if(target_check){left=Math.round((winWidth/2)-(this.options.width/2));if(winHeight>this.options.height){top=Math.round((winHeight/2)-(this.options.height/2));}
window.open(target.href,'intent',this.options.windowOptions+',width='+this.options.width+',height='+this.options.height+',left='+left+',top='+top);event.returnValue=false;event.preventDefault&&event.preventDefault();}}}});AURORA.PremiumAdContentView=mp.View.extend({init:function(){mp.PubSub.subscribe("banner-moved",_.bind(function(placeHolder){var gaUrl,dataElement;if(placeHolder.indexOf("premium-content-left")===0){dataElement=$('.premium-content-box.first .button');gaUrl=$("#premium-content-left").data("ga-track-page-view");this.buildPremiumAdContent('premiumContentLeftDialog',dataElement,gaUrl,window);}
if(placeHolder.indexOf("premium-content-right")===0){dataElement=$('.premium-content-box:not(.first) .button');gaUrl=$("#premium-content-right").data("ga-track-page-view");this.buildPremiumAdContent('premiumContentRightDialog',dataElement,gaUrl,window);}
if(placeHolder.indexOf("banner-textlink")===0){if($('#'+placeHolder).html()!==""){$("#vip-right .top-border").show();$("#"+placeHolder).show();}}},this));mp.PubSub.subscribe("gpt-loaded",_.bind(function(obj){var placeHolder=$("#"+obj.adPosition),stripWhiteSpace=function(html){return html.replace(/^\s+|\s+$/g,'');},gaUrl,dataElement,html=stripWhiteSpace(obj.adHtml),adEl=$(html);placeHolder.find('iframe').css('display',"none");placeHolder.append(adEl);if(obj.adPosition==="premium-content-left"){dataElement=$('.premium-content-box.first .button');gaUrl=$("#premium-content-left").data("ga-track-page-view");this.buildPremiumAdContent('premiumContentLeftDialog',dataElement,gaUrl,window);}
if(obj.adPosition==="premium-content-right"){dataElement=$('.premium-content-box:not(.first) .button');gaUrl=$("#premium-content-right").data("ga-track-page-view");this.buildPremiumAdContent('premiumContentRightDialog',dataElement,gaUrl,window);}},this));},buildPremiumAdContent:function(childViewName,dataElement,gaUrl,win){var urlContent=dataElement.attr('data-content-dialog'),target=dataElement.attr('data-content-target'),isDialog=(typeof target!=='undefined'&&target==='dialog');if(urlContent===undefined)return;if(isDialog){var title=dataElement.attr('data-title-dialog'),width=dataElement.attr('data-content-width'),height=dataElement.attr('data-content-height');if(this.model.get('isCarVip')){var carInfo=this.model.get('car');title=title.replace('%CATEGORY_OR_MODEL%',this.model.get('categories').l2.name+(carInfo.model==='-'?'':' '+carInfo.model));urlContent=urlContent.replace('%LICENSEPLATE%',carInfo.licensePlate);}
width=(typeof width!=='undefined')?width:"100%";height=(typeof height!=='undefined')?height:dataElement.contentWindow.document.body.scrollHeight+'px';var content='<iframe style="width: '+width+'; height: '+height+'; border: none;" frameBorder="0" scrolling="no" src="'+urlContent+'"></iframe>';this.appendChildView(childViewName,new mp.Dialog({id:'dialog_'+childViewName,modal:true,width:768+30,templateData:{title:title,content:content}}));}else{this.appendChildView(childViewName,{show:function(){win.open(urlContent,"_blank");}});}
dataElement.click(_.bind(function(){AURORA.googleAnalyticsManagerInstance.trackPageView(gaUrl);this.getChildView(childViewName).show();},this));}});AURORA.nameSpace.create("AURORA.templates");AURORA.templates.printVip=unescape("%3Cimg%20width%3D%22200%22%20height%3D%2221%22%20alt%3D%22Marktplaats%22%20src%3D%22/aurora/res/images/logos/marktplaats-logo.png%22%3E%3Cdiv%20class%3D%22line%22%3E%3C/div%3E%3Cdiv%20class%3D%22adtitle%22%3E%7B%7B%20title%20%7D%7D%3C/div%3E%3Cdiv%20class%3D%22crumb%22%3E%20%20%20%20%7B%7B%23breadcrumb%7D%7D%20%20%20%20%3Cli%3E%7B%7B%20.%20%7D%7D%3C/li%3E%20%20%20%20%7B%7B/breadcrumb%7D%7D%3C/div%3E%3Cdiv%20class%3D%22clear%22%3E%3C/div%3E%3Cimg%20class%3D%22adphoto%22%20src%3D%22http%3A%7B%7B%7BfirstPhoto%7D%7D%7D%22%20/%3E%3Cdiv%20class%3D%22adprice%22%3E%7B%7B%7B%20price%20%7D%7D%7D%3C/div%3E%3Cdiv%20class%3D%22shipping%22%3E%7B%7B%20shippingCosts%20%7D%7D%3C/div%3E%3Cdiv%20class%3D%22seller%22%3E%20%20%20%20%3Cdiv%20class%3D%22print-header%22%3E%7B%7B%20sellerName%20%7D%7D%3C/div%3E%20%20%20%20%3Cdiv%3E%7B%7B%20sellerActiveSince%20%7D%7D%20actief%20op%20Marktplaats%3C/div%3E%20%20%20%20%3Cdiv%3E%7B%7B%20sellerLocation%20%7D%7D%3C/div%3E%20%20%20%20%3Cdiv%3E%7B%7B%20sellerPhoneNumber%20%7D%7D%3C/div%3E%20%20%20%20%3Cdiv%3E%7B%7B%7B%20websiteLink%20%7D%7D%7D%3C/div%3E%20%20%20%20%3Cdiv%3E%20%20%20%20%20%20%20%20%7B%7B%23paypalAccepted%7D%7D%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22/aurora/res/images/logos/paypal_accept.png%22%20/%3E%20%20%20%20%20%20%20%20%7B%7B/paypalAccepted%7D%7D%20%20%20%20%3C/div%3E%3C/div%3E%3Cdiv%20class%3D%22clear%22%3E%3C/div%3E%7B%7B%23hasAttributes%7D%7D%3Cdiv%20class%3D%22print-header%22%3EKenmerken%3C/div%3E%7B%7B/hasAttributes%7D%7D%3Cdiv%20class%3D%22clear%22%3E%3C/div%3E%3Cdiv%20class%3D%22attr%22%3E%20%20%20%20%7B%7B%23attributes%7D%7D%20%20%20%20%3Cdiv%20class%3D%22label%22%3E%7B%7Blabel%7D%7D%3C/div%3E%20%20%20%20%3Cdiv%20class%3D%22value%22%3E%7B%7Bvalue%7D%7D%26nbsp%3B%7B%7Bunit%7D%7D%3C/div%3E%20%20%20%20%3Cdiv%20class%3D%22clear2%22%3E%3C/div%3E%20%20%20%20%7B%7B/attributes%7D%7D%3C/div%3E%3Cdiv%20class%3D%22clear%22%3E%3C/div%3E%3Cdiv%20class%3D%22print-header%22%3EBeschrijving%3C/div%3E%3Cdiv%20class%3D%22clear%22%3E%3C/div%3E%3Cdiv%3E%7B%7B%7B%20description%20%7D%7D%7D%3C/div%3E");AURORA.nameSpace.create("AURORA.templates");AURORA.templates.casHorizontalAdBlock=unescape("%3Cdiv%20id%3D%27cas-listings-on-top-header%27%3E%20%20%20%20%3Cspan%20id%3D%22cas-listings-on-top-title%22%3E%7B%7Btitle%7D%7D%3C/span%3E%3C/div%3E%3Cdiv%20id%3D%27cas-listings-on-top-container%27%3E%20%20%20%20%7B%7B%23snippets%7D%7D%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cas-on-top-listing%27%20data-ad-url%3D%27%7B%7BvipUrl%7D%7D%27%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cas-on-top-listing-thumb%27%20%3E%3Cimg%20src%3D%27%7B%7BprimaryImageUrl%7D%7D%27/%3E%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cas-on-top-listing-title%20ellipsis%27%3E%7B%7Btitle%7D%7D%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%27cas-on-top-listing-price%27%3E%7B%7BformattedPrice%7D%7D%3C/div%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%7B%7B/snippets%7D%7D%3C/div%3E");AURORA.gptBanners={loadBanners:function(bannerData,enableSingleRequest,gptTest){mp.PubSub.subscribe("gpt-no-banner",function(obj){var acc=document.getElementsByName(obj.iFrameName),adIframe=$(acc);adIframe.parent().parent().hide();});googletag.cmd.push(function(){bannerData.forEach(function(data){var slot=googletag.defineSlot(data.adUnit,data.sizes,data.target).addService(googletag.pubads());for(key in data.bannerParameters){slot.setTargeting(key,data.bannerParameters[key]);}});googletag.pubads().setTargeting("test",gptTest);if(enableSingleRequest){googletag.pubads().enableSingleRequest();}
googletag.pubads().collapseEmptyDivs();googletag.enableServices();bannerData.forEach(function(data){googletag.display(data.target);});});}};