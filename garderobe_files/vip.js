
AURORA.page('vip',{childViews:{myMpMenu:new AURORA.HeaderMenu({el:$('body')}),largeImageDialog:new mp.Dialog({el:$('#large-image-dialog'),modal:true}),carWarrantyDialog:new mp.Dialog({el:$('#warranty-dialog'),modal:true}),dialog:new mp.Dialog({el:$('#abq-dialog'),modal:true}),paypalAcceptedTooltip:new mp.Tooltip({target:$('#vip-accept-paypal-logo img[data-tooltip]'),hideDelay:1000,stayOnHover:true}),form:new mp.Form({el:$('#abq-form'),onSubmit:function(evt){if(evt!==undefined)evt.preventDefault();this.getChildView('progressOverlay').display();var sendAbqWrapper=_.bind(this.parentView.sendAbq,this);_.delay(sendAbqWrapper,500);return false;}}),bids:new mp.Bids({el:$('#vip-bidding-block')}),uspsInfoIcons:new AURORA.InfoIcons({el:$('#usps-block-container')}),outletInfoIcons:new AURORA.InfoIcons({el:$('#vip-seller')})},options:{observers:{'ajax-error':AURORA.defaultAjaxErrorHandler,'ajax-success':AURORA.defaultAjaxSuccessHandler,'carousel:rendered':'initCarousels','carousel:mouseover':'highlightThumbnail'}},init:function(){if($("#page-wrapper").width()<480){window.scrollTo(0,1);}
this.initImageViewer();_.bindAll(this,'initCarousels','openLargeImageDialog');window.onbeforeunload=function(){if($('.editable').hasClass('active')){return'U heeft uw advertentietekst aangepast. Indien u deze pagina nu verlaat dan worden uw wijzigingen niet opgeslagen.';}};this.initGallery();this.initFavouriteButtons(function(){if(AURORA.audienceScienceManagerInstance!==undefined){AURORA.audienceScienceManagerInstance.triggerCustomEvent('addToFavorites');}});this.initMap();this.initAbq();this.initSellerOwnItems();this.initFlaggingPopUp();this.initPremiumAdContent();if(this.model.get('isCarVip')===true){this.initCarTabs();this.initTextAdsCar();}else{this.initTextAdsNonCar();}
this.initToolTips();this.initCasListing();this.initDialogAdLink();this.initShortLink();this.initPrintButton();this.initAutoComplete();this.initSocialPopUp();this.hideTrackingPixels();},initTextAdsCar:function(){if(this.model!==undefined&&this.model.get('gptBanners')){googletag.cmd.push(function(){googletag.pubads().addEventListener('slotRenderEnded',function(event){if(!event.isEmpty){$('#vip-right .top-border').show();$('#banner-textlink-1').show();$('#banner-textlink-2').show();}});});}},initTextAdsNonCar:function(){mp.PubSub.subscribe("banner-moved",_.bind(function(placeHolder){if(placeHolder.indexOf("banner-textlink")===0){if($('#'+placeHolder).html()!==""){$("#"+placeHolder).show();}}},this));},initAutoComplete:function(){var resentSearches=false;if(this.model.get('recentSearches')!==undefined)resentSearches=this.model.get('recentSearches');this.appendChildView('autoComplete',new mp.AutoComplete({inputElement:$('#query'),model:(function(){var mySuggestionModel=new mp.SuggestionsModel({});mySuggestionModel.suggestionUrl=$('#query').data('suggestion-url');return mySuggestionModel;}()),categorySelectElement:$('#search-categories'),recentSearches:resentSearches}));},initShortLink:function(){$('.short-link input').click(function(){$(this).select();});},initPrintButton:function(){this.appendChildView('printButton',new AURORA.PrintVipButton({template:AURORA.templates.printVip,el:$('#print-button'),model:(function(){var printVipModel=new AURORA.PrintVipModel({});printVipModel.url=$('#print-button').data('vip-json-data-url');return printVipModel;}())}));},initDialogAdLink:function(){if($("#dialog-adlink").length===0)return;$('#dialog-adlink').mouseenter(function(evt){$('#dialog-adlink span').css("text-decoration","underline");}).mouseleave(function(evt){$('#dialog-adlink span').css("text-decoration","none");});$('#dialog-adlink').bind('click',_.bind(function(evt){var url,title,gaUrl;if($(evt.target).data('url')===undefined){url=$(evt.target).parent().data('url');title=$(evt.target).parent().data('dialog-title');gaUrl=$(evt.target).parent().data('ga-page-view-onclick-url');}else{url=$(evt.target).data('url');title=$(evt.target).data('dialog-title');gaUrl=$(evt.target).data('ga-page-view-onclick-url');}
AURORA.googleAnalyticsManagerInstance.trackPageView(gaUrl);if(this.getChildView('adLinkDialog')===undefined){this.appendChildView('adLinkDialog',new mp.Dialog({id:'ablDialog',modal:true,width:715,height:384,templateData:{title:title,content:'<div id="adLinkDialogContent"><iframe id="adLinkDialogIframe" width="100%" scrolling="auto" height="344px" frameborder="0" src="'+url+'" border="0"></iframe></div>'}}));}
this.getChildView('adLinkDialog').show();},this));},initPremiumAdContent:function(){this.appendChildView('premiumAdContent',new AURORA.PremiumAdContentView({model:this.model}));},initCarTabs:function(){this.appendChildView('carTabs',new mp.Tabs({el:$('#car-tabs'),tabElementClass:'car-tab',selectedIndex:$('#selectedIndex'),indexFilter:{'0':'first','1':'second','first':'0','second':'1'}}));},initToolTips:function(){this.appendChildView('bubbleHelp',new AURORA.BubbleHelp({targetClasses:['more-info','post-nl-costs','cas-on-top-listing'],bubbleContentDataAttributeName:'tooltip',templates:{"galleryListingTemplate":AURORA.templates.galleryViewImageBubbleText}}));},initImageViewer:function(){var imageSize='large';if($('body').hasClass('big-picture')){imageSize='extraLarge';}
this.appendChildView('imageViewer',new mp.CarouselImageViewer({el:$('#vip-image-viewer'),sourceId:'vip-carousel',imageSize:imageSize,isEtalageFeatureEnabled:this.model.get("isEtalageFeatureEnabled"),ryiMode:false}));},initCarousels:function(carousel,ads){mp.PubSub.unsubscribe('carousel:rendered');this.highlightThumbnail(carousel,0);this.initLargeImage();},highlightThumbnail:function(carousel,imageIndex){carousel.setSelected(imageIndex);},initFavouriteButtons:function(callback){this.$('#fav-form-top, #fav-form-bottom').submit(function(){var form=$(this);$.getJSON(form.attr('action')+"?callback=?",form.serialize(),function(resp){if(resp.valid){$('.fav-btn').removeClass('enabled no-fav-ad').addClass('fav-ad disabled').prop('disabled',true);$('.message').hide();$('#msg-saved-ad').show();if(_.isFunction(callback)){callback();}}});return false;});},initGallery:function(){this.imageModels=this.buildImageModels();this.appendChildView('thumbsCarousel',new mp.Carousel({el:$('#vip-carousel'),collection:new mp.ImageCollection(mp.ImageCollection.prototype.parse(this.imageModels)),batchSize:5,alwaysShowButtons:false,showTooltip:false,hideWhenEmpty:(this.model.get('isCarVip')?false:true),mustFetch:false}));this.getChildView('thumbsCarousel').render();},buildImageModels:function(){var models=[],imagesS=this.readImageUrlsFromDataTag('images-s'),imagesL=this.readImageUrlsFromDataTag('images-l'),imagesXL=this.readImageUrlsFromDataTag('images-xl'),imagesSequenceNumbers=this.readImageUrlsFromDataTag('images-sequence-numbers');for(var i=0;i<imagesSequenceNumbers.length;i++){if(imagesS[i].length!==0){models[imagesSequenceNumbers[i]-1]={urls:{s:imagesS[i],l:imagesL[i],xl:imagesXL[i]},sequenceNumber:imagesSequenceNumbers[i]};}}
return models;},readImageUrlsFromDataTag:function(name){var result=[],data=$('#vip-carousel').data(name);if(!_.isUndefined(data)){result=data.toString().split('&');}
return result;},initMap:function(){var anchor=this.$('#vip-map-show');if(!anchor.length){return;}
var lat=parseFloat(anchor.attr('lat')),lng=parseFloat(anchor.attr('long')),icon=anchor.attr('icon'),title=$('#title').html();this.$('#vip-map-show').click(_.bind(function(event){event.preventDefault();var dialog=new mp.Dialog({el:$('#vip-map-dialog'),modal:true});dialog.show(_.bind(function(){var container=$('#vip-map');if(!container.children().length){container.data('map',new mp.GMap({el:$(container.get(0)),lat:lat,lng:lng,zoom:12,unselectedIconUrl:icon,marker:{lat:lat,lng:lng},title:title,googleMapsUri:this.model.attributes.googleMapVipUrl}));if(this.model!==undefined&&this.model.get('gptBanners')){AURORA.gptBanners.loadBanners(this.model.get('gptBannerForVIPMap'),this.model.get('gptSingleRequest'),this.model.get('gptTest'));}}else{container.data('map').panTo(lat,lng);}},this));if(!this.model.get('gptBanners')&&$('#vip-map-banner-iframe').length===0){this.loadMapBanner();}},this));},initLargeImage:function(){var largeImageDialog=this.getChildView('largeImageDialog');largeImageDialog.appendChildView('dialogImageViewer',new mp.CarouselImageViewer({el:$('#vip-large-image-viewer'),imageSize:'extraLarge',sourceId:'vip-large-image-carousel'}));largeImageDialog.appendChildView('dialogCarousel',this.getPopupCarousel());largeImageDialog.getChildView('dialogCarousel').render();$('#large-image-link').click(this.openLargeImageDialog);$('#vip-image-viewer').on('click','.image',_.bind(function(){$('#large-image-link').click();},this));},openLargeImageDialog:function(){var largeImageDialog=this.getChildView('largeImageDialog');largeImageDialog.show();var selectedImageIndex=$('#vip-carousel .thumb-placeholder').closest('.selected').index(),popupImageIndex=$('#vip-large-image-carousel a.thumb-placeholder').eq(selectedImageIndex).index();this.highlightThumbnail(largeImageDialog.getChildView('dialogCarousel'),popupImageIndex);_.defer(largeImageDialog.getChildView('dialogImageViewer').update,largeImageDialog.getChildView('dialogCarousel'),selectedImageIndex);},getPopupCarousel:function(){return new mp.Carousel({el:$('#vip-large-image-carousel'),collection:this.getChildView('thumbsCarousel').collection,vertical:true,batchSize:5,alwaysShowButtons:false,showTooltip:false,mustFetch:false});},initFlaggingPopUp:function(){var buttonEl=$('#flagging-popup-button'),modelUrl=buttonEl.data('model-url'),autoCenter=/(ipad)/.test(AURORA.Page.browser.platform);if(modelUrl){this.appendChildView('flaggingPopup',new AURORA.flaggingPopUp({el:$('#flagging-dialog'),flaggingButtonEl:buttonEl,flaggingOptionsEl:$('#flagging-options'),autoCenter:autoCenter,model:(function(){var flaggingPopUpModel=new AURORA.flaggingPopUpModel({});flaggingPopUpModel.url=modelUrl;return flaggingPopUpModel;}())}));}},loadMapBanner:function(){var bannerUrl=$('#vip-map-banner').data('banner-url'),iFrame=document.createElement("iframe"),targetEl=document.getElementById('vip-map-banner');if(targetEl===null){return;}
iFrame.id="vip-map-banner-iframe";iFrame.frameBorder="0";iFrame.scrolling="no";iFrame.src='/vip/banner-iframed-content.html?url='+encodeURI(bannerUrl);targetEl.appendChild(iFrame);var counter=0,Int;var intervalFunction=function(){var iFramedMapBanner=null,bannerHeight;if(iFrame.contentDocument){iFramedMapBanner=$('#iframed-map-banner',$('#vip-map-banner-iframe').get(0).contentDocument);}else{iFramedMapBanner=$("#vip-map-banner-iframe").contents().find("#iframed-map-banner");}
bannerHeight=iFramedMapBanner.height();if(bannerHeight>0||counter===10){if(bannerHeight<2){$('#vip-map-banner').remove();}
clearInterval(Int);}
counter++;};Int=setInterval(intervalFunction,1000);},initSocialPopUp:function(){this.appendChildView('twitterPopUp',new AURORA.SocialMediaPopUp({el:$('.twitter-link'),intentRegex:/twitter\.com(\:\d{2,4})?\/intent\/(\w+)/}));this.appendChildView('facebookPopUp',new AURORA.SocialMediaPopUp({el:$('.facebook-link'),intentRegex:/facebook\.com\/share\.php/}));},initCasListing:function(){if($('#similar-cas-items').length!==0){this.buildTopCasListings();}else{this.buildRightCasListings();}},buildTopCasListings:function(){if($('#similar-cas-items').length===0)return;this.appendChildView('casListing',new AURORA.casAdBlock({el:$('#similar-cas-items'),orientation:"horizontal",model:(function(){var listingModel=new AURORA.casAdBlockModel({});listingModel.url=$('#similar-cas-items').data('url');listingModel.parse=function(resp,xhr){return{casAds:resp};};return listingModel;}())}));},buildRightCasListings:function(){if($('#vip-right-cas-listings').length===0)return;this.appendChildView('casListing',new AURORA.casAdBlock({el:$('#vip-right-cas-listings'),model:(function(){var listingModel=new AURORA.casAdBlockModel({});listingModel.url=$('#vip-right-cas-listings').data('url');listingModel.parse=function(resp,xhr){return{casAds:resp};};return listingModel;}())}));},initSellerOwnItems:function(){if($('#seller-own-ads').length===0)return;this.appendChildView('sellerOwnAds',new AURORA.SellerOwnAds({el:$('#seller-own-ads'),model:new mp.Model}));},hideTrackingPixels:function(){$(document).ready(function(){_.delay(function(){$("img[src*='scorecardresearch']").css({'display':'none'});$("img[src*='betrad']").css({'display':'none'});},1000);});},initAbq:function(){var form=this.getChildView('form');form.appendChildViews({sellerPhoneNumber:new mp.PhoneNumberInput({el:$('#sellerPhoneNumber'),form:form}),message:new mp.Input({el:$('#abq-message'),form:form,required:true,messages:{required:mp.msg('abq.message.required')},styles:{error:{iconInside:false,iconOutside:false,textBelow:true,tooltip:false}}}),progressOverlay:new mp.Overlay({el:form.$('.overlayed.abq-loader'),target:$('#abq-dialog')}),successOverlay:new mp.Overlay({el:form.$('.abq-success'),target:$('#abq-dialog')})});$('.abq-link').click(_.bind(this.prefillAbq,this));mp.PubSub.subscribe('bids:ryi-bids-removed',_.bind(function(){$('.abq-link').click(_.bind(this.prefillAbq,this));},this));},prefillAbq:function(evt){evt.preventDefault();var form=$('#abq-form'),link=$(evt.target),bidderName=link.data('bidder-name'),bidId=link.data('bid-id'),bidAmountFormatted=link.data('bid-amount-formatted');$('#abq-amount').text(bidAmountFormatted);$('#abq-bidder-name').text(bidderName);$('#abq-bidder-name-feedback').text(bidderName);form.find('[name=bidId]').val(bidId);this.getChildView('dialog').show();_.delay(function(){$('#abq-message').focus();},600);},sendAbq:function(){$.post($(this.el).attr("action"),$(this.el).serialize(),_.bind(function(response){this.getChildView('progressOverlay').hide();if(!response.valid){_.each(response.errors,function(err){this.getChildView(err.target).mark(false,mp.msg(err.msgKey));},this);}else{AURORA.googleAnalyticsManagerInstance.fireOperationsOnSuccess($(this.el));this.getChildView('successOverlay').display();_.delay(_.bind(this.parentView.showFeedbackAbq,this),800);}},this),"json");},showFeedbackAbq:function(){this.getChildView('successOverlay').hide();this.parentView.getChildView('dialog').hide();$('#msg-sent-abq').fadeIn('fast');}},{analytics:true,banners:true,waitForModel:true});